pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- game_jam

function _init()
 -- global vars
	t=0
	roomx=0
	roomy=0
	cellx=0
	celly=0
	score=0
	msg=''

	-- 웃
	웃={}
	웃.x=32
	웃.y=64
	웃.dx=0
	웃.dy=0
	웃.spr=001
	-- [idle, walk]
	웃.state=0
	웃.max_speed=2

	can_shoot=true

	-- test123	
	-- thanks doc_robs!
	dust={}
	
 shots=new_group(shot)
	booms=new_group(boom)
	crocs=new_group(croc)

	--crocs:new({x=80,y=112,d=true})
end

function _update()
	t=(t+1)%64

 handle_input()
	
 웃.x+=웃.dx	
	웃.y+=웃.dy

	웃.spr = set_spr(웃.state, 001)

 -- friction
	if 웃.dx > 0.1 then
		웃.dx -= 0.1
	elseif 웃.dx < -0.1 then
		웃.dx += 0.1
	else
		웃.dx = 0
	end
 
 shots:update()
 booms:update()
 crocs:update()

	for d in all(dust) do
  d:update()
 end

 -- set room
	roomx=(웃.x\128)*128
	roomy=(웃.y\128)*128
end

function _draw()
	cls()
	
	camera(max(0,웃.x-64), roomy)
	
	map(0,0,0,0,16,16)
	spr(웃.spr,웃.x,웃.y,1,1)

	shots:draw()
 booms:draw()
	crocs:draw()

 for d in all(dust) do
  d:draw()
 end
	
	debug()
end
-->8
-- todo: draw
-->8
-- debug

_log={}
log_l=1
for i=1,log_l do
	add(_log,'')
end

function log(str)
	add(_log,str)
end

function debug()
	vars = {
	'x='..웃.x,
	'y='..웃.y,
	'dx='..웃.dx,
	'dy='..웃.dy,
	--'state='..웃.state
	'roomx='..roomx,
	'roomy='..roomy,
	--'shots='..count(shots._)
	}

 -- draw the log
	for i=count(_log)-log_l+1,count(_log) do
		add(vars,'> '.._log[i])
	end

	for i,v in ipairs(vars) do
		print(v,roomx+8,i*8,15)
	end
end
-->8
-- char

function handle_input()
	-- l/r
 if btn(0) then
 	웃.dx-=0.2
	elseif btn(1) then
	 웃.dx+=0.2
	end
	
	-- u/d
	if btn(2) then
	 웃.dy-=0.2
	elseif btn(3) then
	 웃.dy+=0.2
	end
	
	-- x
	if btn(5) then
	end

 -- z
 if btnp(4) then
 	sfx(2)
 end
end

function set_spr(state, base_spr)
 return 001
end
-->8
-- dust
function add_new_dust(_x,_y,_dx,_dy,_l,_s,_g,_f)
add(dust, {
fade=_f,x=_x,y=_y,dx=_dx,dy=_dy,life=_l,orig_life=_l,rad=_s,col=0,grav=_g,draw=function(self)
pal()palt()circfill(self.x,self.y,self.rad,self.col)
end,update=function(self)
self.x+=self.dx self.y+=self.dy
self.dy+=self.grav self.rad*=0.9 self.life-=1
if type(self.fade)=="table"then self.col=self.fade[flr(#self.fade*(self.life/self.orig_life))+1]else self.col=self.fade end
if self.life<0then del(dust,self)end end})
end
-->8
-- objects

function new_group(bp)
 return {
		_={},
		bp=bp,
		
		new=function(self,p)
		 for k,v in pairs(bp) do
		 	if v!=nil then
		 		p[k]=v
		 	end
		 end
		 p.alive=true
			add(self._,p)
		end,
		
		update=function(self)
			for i,v in ipairs(self._) do
				v:update()
				if v.alive==false then
				 del(self._,self._[i])
				end
			end
		end,
		
		draw=function(self)
			for v in all(self._) do
				spr(v.s,v.x,v.y,ceil(v.w/8),ceil(v.h/8),v.d)
			end
		end
	}
end

shot={
	w=8,
	h=8,
 s=nil,
 x=nil,
 y=nil,
 dx=nil,
 dy=nil,
 d=nil,

 update=function(self)
  -- outside bounds
  -- todo: refactor into func
  if self.x<roomx
  	or self.x>roomx+128
  	or self.y<roomy
  	or self.y>roomy+128 then
   	self.alive=false
  end

		if(self.x>0) cx=self.x+7
		if(self.x<=0) cx=self.x
		if(self.y>0) cy=self.y+7
		if(self.y<=0) cy=self.y
		c=mget(cx\8,cy\8)

		-- destructable
		if fget(c,1) then
			mset(cx\8,cy\8,c+1%5)
			self.alive=false
			booms:new({x=cx,y=cy})
			add_new_dust(cx,cy,rnd(5)-2,rnd(1)-2,5,rnd(4)+2,0.1,4)
			add_new_dust(cx,cy,rnd(5)-2,rnd(1)-2,5,rnd(1)+2,0.1,6)
		end

		-- indestructable
		if fget(c,0) then
			self.alive=false
			booms:new({x=self.x,y=self.y})
		end

 	self.x+=self.dx
 	self.y+=self.dy	
 end
}

boom={
	s=008,
	w=8,
	h=8,
	x=nil,
	y=nil,

 update=function(self)
		self.s+=1
		if(self.s>11) self.alive=false
 end,
}
-->8
-- enemies

croc={
	life=2,
	s=040,
	w=8,
	h=8,
	x=nil,
	y=nil,
	d=nil,

 update=function(self)
 end,
}
__gfx__
00000000002222060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001112050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700002222050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000022222250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000002222050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700002222050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000002002050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000022002050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00006660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00600060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000303000100000000000000000000000000000001000000000000000000000000000101010000000000000000000404000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000155001550025500255003550035500455004550055500655006550075500855008550095500a5500a5500b5500c5500d5500d5500f5500d5500e5000f5000e5000f5000550005500055000550005500
000100000905009050090500805007050060500505003050020500105000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00040000086310063100630006330a6000a6000a6000a6030960309603086030760307603086030860308603006030e6030f6031a603036030f6030f6030e6030e60313603146031460314603136031260312603
01120000000500000000000000000000000000000000000024027280271f027230272402224012070000b0000405000000000000000000000000000000000000280342800528005000002f034000000000000000
01120000000500000000000000000000000000000000000024027280271f027230272402224012070000b000040500000000000000000000000000000000000028034280052f0040000000000000000000000000
011200000405300003000032960334105346050000300003106230000300003000030000300003000030000304053000030000300003000030400304053000031062300003000030000300003000030000300003
01120000000050000500005000050004500045070450c04500005000000000500005000050000500005000050000500005000050000504045040450b045070450000500005000050000500005000050000500005
0112000000500005000050118521185201852218522005000050000500005000050000500005000050000500005002b520005002a52028500285202450024520235222352223522235211c5211c5221c5221c523
011100002305033000240502400023050000001f050000001c050000001a050000001c0541c0501c0501c0551f000000001f0541f0501f0501f0552100000000210542105021051210001f0541f0401f0301f020
011000002f0501770430050240002f050000002b050000002f0501c0002b0501c000240501f000230501f0002305033000240502400023050000001f050000001c0541c0501c0501c0551a0541a0501a0501a055
011000001c0500000000000000001f000000001f0500000000000210000000000000210500000000000000001f050000000000000000000000000000000000002305033000240502400023050000001f05000000
011000001c0500000000000000001f000000001f05000000000000000000000000002305000000000002300023050000002405000000000000000000000000002405000000260500000028050000002405000000
0110000026050000000000000000000000000024050000000000000000000000000021050000001f000000001f050000002105000000000000000000000000002405000000260500000028050000002405000000
0110000026050000000000000000000000000024050000000000000000000000000021050000002b0500000028050000000000000000000000000000000000002305033000240502400023050000001f05000000
011000000406300000241000406300000000000406300000106330000000000040630400000000040630406304063000000000004063000000000004063000001063300000000000400004063000000400004063
__music__
01 05040607
00 05030644
00 05040607
00 05030644
00 05420644
00 05420644
00 05420644
02 41420644
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 09424344
01 0a0e4344
00 0b0e4344
00 0c0e4344
02 0d0e4344

